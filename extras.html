<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Extras - Manchester City</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&family=Roboto+Condensed:wght@100..900&display=swap" rel="stylesheet">
  <style>
    @font-face {
      font-family: 'Kippax Modern';
      src: url('./fonts/KippaxModern-Rg.otf') format('opentype');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }
    @font-face {
      font-family: 'Kippax Modern';
      src: url('./fonts/KippaxModern-Md.otf') format('opentype');
      font-weight: 500;
      font-style: normal;
      font-display: swap;
    }
    @font-face {
      font-family: 'Kippax Modern';
      src: url('./fonts/KippaxModern-Bd.otf') format('opentype');
      font-weight: 700;
      font-style: normal;
      font-display: swap;
    }
    @font-face {
      font-family: 'Kippax Modern';
      src: url('./fonts/KippaxModern-CndRg.otf') format('opentype');
      font-weight: 400;
      font-style: normal;
      font-stretch: condensed;
      font-display: swap;
    }
    @font-face {
      font-family: 'Kippax Modern';
      src: url('./fonts/KippaxModern-CndMd.otf') format('opentype');
      font-weight: 500;
      font-style: normal;
      font-stretch: condensed;
      font-display: swap;
    }
    @font-face {
      font-family: 'Kippax Modern';
      src: url('./fonts/KippaxModern-CndBd.otf') format('opentype');
      font-weight: 700;
      font-style: normal;
      font-stretch: condensed;
      font-display: swap;
    }
    @font-face {
      font-family: 'Kippax Modern';
      src: url('./fonts/KippaxModern-CndxBd.otf') format('opentype');
      font-weight: 800;
      font-style: normal;
      font-stretch: condensed;
      font-display: swap;
    }
    @font-face {
      font-family: 'Kippax Modern';
      src: url('./fonts/KippaxModern-CndBlk.otf') format('opentype');
      font-weight: 900;
      font-style: normal;
      font-stretch: condensed;
      font-display: swap;
    }
  </style>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --color-content-primary: #001838;
      --color-content-on-dark: #ffffff;
      --color-bg-default: #ffffff;
      --color-bg-base-white: #ffffff;
      --color-bg-core-secondary: #98c5e9;
      --spacing-0: 0px;
      --spacing-2: 4px;
      --spacing-3: 6px;
      --spacing-4: 8px;
      --spacing-5: 12px;
      --spacing-6: 16px;
      --spacing-8: 24px;
      --font-family: 'Kippax Modern', sans-serif;
      --font-size-hero-medium: 48px;
      --font-size-hero-large: 60px;
      --line-height-hero-medium: 48px;
      --line-height-hero-large: 56px;
      --font-size-body-large: 18px;
      --line-height-body-large: 26px;
      --font-size-body-medium: 16px;
      --line-height-body-medium: 24px;
      --font-size-body-small: 14px;
      --line-height-body-small: 24px;
      --font-size-body-xsmall: 12px;
      --line-height-body-xsmall: 20px;
      --line-height-label: 16px;
      --border-radius-round: 999px;
      --border-radius-small: 4px;
      --border-radius-medium: 6px;
      --border-radius-large: 8px;
      --border-radius-xlarge: 12px;
      --color-content-tertiary: #69738c;
      --color-border-default: #c8d4e0;
      --color-border-contrast: #001838;
      --color-bg-button-secondary: #DAE9F7;
      --color-bg-card-media: #F1F5F8;
      --color-bg-subtle-primary: #eef5fc;
      --button-height-small: 36px;
      --color-city-electric-blue: #3bd6ff;
      --color-bg-alpha-dark-blue-80: rgba(0, 24, 56, 0.8);
      --blur-xsmall: 4px;
      --border-width-xsmall: 1px;
      --shadow-dropdown: 0 2px 4px -2px rgba(0, 24, 56, 0.06), 0 8px 18px -3px rgba(0, 24, 56, 0.2);
      --color-bg-close-button: #F1F5F8;
    }

    body {
      font-family: var(--font-family);
      -webkit-font-smoothing: antialiased;
      background-color: var(--color-bg-default);
      color: var(--color-content-primary);
      overflow-x: hidden;
      max-width: 375px;
      margin: 0 auto;
    }

    button {
      font-family: inherit;
      cursor: pointer;
      border: none;
      background: none;
    }

    .app {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      background-color: var(--color-bg-base-white);
      width: 375px;
      max-width: 375px;
      margin: 0 auto;
      align-items: center;
    }

    /* Header component – Figma _header__nav (6188:143876), design-system header: 64px, coreSecondary, padding horizontal spacing.6 */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 64px;
      padding: var(--spacing-0) var(--spacing-6);
      background-color: var(--color-bg-core-secondary);
      position: relative;
      z-index: 3;
      width: 375px;
      max-width: 375px;
      box-sizing: border-box;
    }

    .header__burger {
      display: flex;
      align-items: center;
      width: 86px;
    }

    .header__menu-btn {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      background: none;
      border: none;
      padding: 0;
      cursor: pointer;
    }

    .header__menu-icon {
      position: relative;
      width: 16px;
      height: 16px;
      overflow: hidden;
      flex-shrink: 0;
    }

    .header__menu-icon img {
      display: block;
      width: 100%;
      height: 100%;
      max-width: none;
      object-fit: contain;
    }

    .header__logo {
      position: absolute;
      left: 50%;
      top: 8px;
      transform: translateX(-50%);
      display: block;
      text-decoration: none;
    }

    .header__actions {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .header__basket {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--spacing-2);
      border: 1px solid rgba(255, 255, 255, 0.64);
      border-radius: var(--border-radius-round);
      background: linear-gradient(140.753deg, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0.16) 100%);
      position: relative;
      gap: var(--spacing-5);
      text-decoration: none;
      color: inherit;
    }

    .header__basket-icon {
      position: relative;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-content-primary);
    }

    .header__basket-img {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .header__basket-number {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      padding-top: 2px;
      font-family: var(--font-family);
      font-size: 11px;
      font-weight: 700;
      line-height: 1;
      color: var(--color-content-on-dark);
      pointer-events: none;
    }

    .app__content {
      display: flex;
      flex-direction: column;
      gap: 0;
      width: 375px;
      max-width: 375px;
      box-sizing: border-box;
      align-items: stretch;
      padding-bottom: 96px;
    }

    /* Hero / Marketing – Figma node 6323:1162224, 375×520 */
    .hero {
      position: relative;
      width: 100%;
      min-height: 520px;
      display: flex;
      align-items: flex-end;
      overflow: hidden;
    }

    .hero__bg {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 0;
    }

    .hero__overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(0, 24, 56, 0) 8%, rgba(0, 24, 56, 0.92) 60%, rgba(0, 24, 56, 1) 92%);
      z-index: 1;
    }

    .hero__content {
      position: relative;
      z-index: 2;
      color: var(--color-content-on-dark);
      width: 100%;
      padding: 112px var(--spacing-6) 24px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .hero__title-block {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .hero__title {
      font-size: var(--font-size-hero-large);
      font-weight: 800;
      line-height: var(--line-height-hero-large);
      letter-spacing: -1px;
      color: var(--color-content-on-dark);
      font-family: var(--font-family);
      font-stretch: condensed;
      margin: 0;
      text-transform: uppercase;
    }

    .hero__description {
      font-size: 16px;
      font-weight: 400;
      line-height: 24px;
      color: var(--color-content-on-dark);
      opacity: 0.8;
      margin: 0;
    }

    /* Tabs – Figma 6323:1162226: pill active (radius 999px), text-only inactive, gap 4px, 36px height */
    .extras-tabs {
      display: flex;
      flex-direction: column;
      width: 100%;
      padding: 32px var(--spacing-6) var(--spacing-6);
      box-sizing: border-box;
    }

    .extras-tabs__group {
      display: flex;
      gap: 4px;
      align-items: center;
      overflow-x: auto;
      overflow-y: hidden;
      width: 100%;
      min-height: 36px;
      box-sizing: border-box;
    }

    .extras-tabs__tab {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 6px 12px;
      border: none;
      border-radius: 0;
      background: transparent;
      cursor: pointer;
      white-space: nowrap;
      font-family: var(--font-family);
      font-size: 14px;
      font-weight: 500;
      line-height: 24px;
      color: var(--color-content-tertiary);
      transition: color 0.2s ease, background 0.2s ease;
      box-sizing: border-box;
    }

    .extras-tabs__tab:hover {
      color: var(--color-content-primary);
    }

    .extras-tabs__tab--active {
      border-radius: 999px;
      background: var(--color-content-primary);
      color: var(--color-content-on-dark);
      font-weight: 700;
    }

    /* Cards – Figma node 6323:1165615 (Ecom Card): radius 8 card, 4 image, gap 16 image–content, gap 6 title–variant, fonts 14/12 */
    .extras-cards {
      display: flex;
      flex-wrap: wrap;
      align-items: stretch;
      gap: var(--spacing-8);
      width: 100%;
      padding: var(--spacing-4) var(--spacing-6) 20px;
      box-sizing: border-box;
    }

    .extras-card {
      flex: 0 1 calc(50% - var(--spacing-8) / 2);
      min-width: 0;
      display: flex;
      flex-direction: column;
      border-radius: var(--border-radius-large);
      background: var(--color-bg-base-white);
    }

    .extras-card__media {
      width: 100%;
      aspect-ratio: 163.5 / 218;
      border-radius: 6px;
      overflow: hidden;
      flex-shrink: 0;
    }

    .extras-card__media--png {
      background-color: var(--color-bg-card-media);
    }

    .extras-card__media img {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 6px;
    }

    .extras-card__content {
      display: flex;
      flex-direction: column;
      flex: 1 1 0;
      min-width: 0;
      padding: var(--spacing-6) 0 0;
      gap: 12px;
    }

    .extras-card__text {
      display: flex;
      flex-direction: column;
      gap: 2px;
      flex-shrink: 0;
    }

    .extras-card__more {
      width: 100%;
      height: 44px;
      flex-shrink: 0;
      padding: 0 var(--spacing-6);
      border-radius: var(--border-radius-medium);
      background: var(--color-bg-base-white);
      border: 1px solid var(--color-border-default);
      color: var(--color-content-primary);
      font-family: var(--font-family);
      font-size: var(--font-size-body-small);
      font-weight: 700;
      line-height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      text-decoration: none;
      box-sizing: border-box;
    }

    .extras-card__title {
      font-family: var(--font-family);
      font-size: var(--font-size-body-small);
      font-weight: 500;
      line-height: var(--line-height-body-small);
      color: var(--color-content-primary);
      margin: 0;
    }

    .extras-card__price {
      font-family: var(--font-family);
      font-size: var(--font-size-body-small);
      font-weight: 500;
      line-height: var(--line-height-body-small);
      color: var(--color-content-primary);
      margin: 0;
    }

    .extras-card__variant {
      font-family: var(--font-family);
      font-size: var(--font-size-body-xsmall);
      font-weight: 400;
      line-height: var(--line-height-body-xsmall);
      color: var(--color-content-tertiary);
      margin: 0;
    }

    .extras-card__add {
      width: 100%;
      height: 36px;
      margin-top: auto;
      padding: 8px var(--spacing-5);
      border-radius: var(--border-radius-medium);
      background: var(--color-bg-button-secondary);
      color: var(--color-content-primary);
      font-family: var(--font-family);
      font-size: var(--font-size-body-xsmall);
      font-weight: 700;
      line-height: var(--line-height-label);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-4);
      cursor: pointer;
      border: none;
      box-sizing: border-box;
    }

    .extras-card__add:disabled {
      cursor: not-allowed;
      opacity: 0.9;
    }

    .extras-card__add-spinner {
      width: 24px;
      height: 24px;
      flex-shrink: 0;
      display: block;
    }

    .extras-card__add-spinner svg {
      display: block;
      width: 100%;
      height: 100%;
    }

    .extras-card__quantity-wrap {
      position: relative;
      width: 100%;
      margin-top: auto;
    }

    .extras-card__quantity-trigger {
      display: flex;
      align-items: center;
      width: 100%;
      height: 36px;
      padding: 8px var(--spacing-5);
      padding-right: 36px;
      font-size: var(--font-size-body-medium);
      font-family: var(--font-family);
      font-weight: 500;
      line-height: var(--line-height-body-medium);
      color: var(--color-content-primary);
      background-color: var(--color-bg-default);
      border: var(--border-width-xsmall) solid var(--color-border-default);
      border-radius: var(--border-radius-large);
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8' fill='none'%3E%3Cpath d='M1 1L6 6L11 1' stroke='%23001838' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right var(--spacing-5) center;
      cursor: pointer;
      text-align: left;
      box-sizing: border-box;
    }

    .extras-card__quantity-dropdown {
      position: absolute;
      left: 0;
      right: 0;
      top: 100%;
      margin-top: var(--spacing-2);
      background-color: var(--color-bg-default);
      border: var(--border-width-xsmall) solid var(--color-border-default);
      border-radius: var(--border-radius-large);
      box-shadow: var(--shadow-dropdown);
      z-index: 10;
      overflow: hidden;
    }

    .extras-card__quantity-dropdown--flip-up {
      top: auto;
      bottom: 100%;
      margin-top: 0;
      margin-bottom: var(--spacing-2);
    }

    .extras-card__quantity-option {
      display: flex;
      align-items: center;
      width: 100%;
      padding: var(--spacing-5) var(--spacing-6);
      font-size: var(--font-size-body-medium);
      font-family: var(--font-family);
      font-weight: 500;
      color: var(--color-content-primary);
      background: none;
      border: none;
      cursor: pointer;
      text-align: left;
    }

    .extras-card__quantity-option:hover {
      background-color: var(--color-bg-subtle-primary);
    }

    .extras-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      width: 100%;
      padding: var(--spacing-6) var(--spacing-6) var(--spacing-8);
      padding-bottom: calc(var(--spacing-8) + env(safe-area-inset-bottom, 0));
      background-color: var(--color-bg-base-white);
      box-shadow: 0 -2px 8px rgba(0, 24, 56, 0.06);
      box-sizing: border-box;
      z-index: 10;
    }

    .extras-footer .basket-cta {
      width: 100%;
      height: var(--button-height-small);
      padding: var(--spacing-4) var(--spacing-5);
      background-color: var(--color-content-primary);
      color: var(--color-content-on-dark);
      border: none;
      border-radius: var(--border-radius-medium);
      font-family: var(--font-family);
      font-size: var(--font-size-body-small);
      font-weight: 700;
      line-height: var(--line-height-body-small);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      box-sizing: border-box;
    }

    .extras-footer .basket-cta:hover {
      opacity: 0.95;
    }

    /* Add to basket – slide-up drawer (same background as loading spinner) */
    @keyframes add-to-basket-backdrop-fade-in {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .add-to-basket-drawer-backdrop {
      position: fixed;
      inset: 0;
      max-width: 375px;
      margin: 0 auto;
      z-index: 19;
      background-color: var(--color-bg-alpha-dark-blue-80);
      backdrop-filter: blur(var(--blur-xsmall));
      -webkit-backdrop-filter: blur(var(--blur-xsmall));
      cursor: pointer;
      animation: add-to-basket-backdrop-fade-in 800ms ease-out forwards;
    }

    .add-to-basket-drawer {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      max-width: 375px;
      margin: 0 auto;
      z-index: 20;
      max-height: 80vh;
      transform: translateY(100%);
      transition: transform 200ms ease-in;
      box-sizing: border-box;
    }

    .add-to-basket-drawer--open {
      transform: translateY(0);
    }

    /* Figma panel: design-system card – padding 16 16 24 16 (spacing.6, spacing.6, spacing.8, spacing.6), gap 16, radius xlarge top */
    .add-to-basket-drawer__panel {
      width: 100%;
      padding: var(--spacing-6) var(--spacing-6) var(--spacing-8) var(--spacing-6);
      padding-bottom: calc(var(--spacing-8) + 8px + env(safe-area-inset-bottom, 0));
      background-color: var(--color-bg-base-white);
      border-radius: var(--border-radius-xlarge) var(--border-radius-xlarge) 0 0;
      border: var(--border-width-xsmall) solid var(--color-border-default);
      border-bottom: none;
      box-shadow: var(--shadow-dropdown);
      display: flex;
      flex-direction: column;
      gap: var(--spacing-6);
      min-height: 120px;
      box-sizing: border-box;
    }

    .add-to-basket-drawer__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      gap: var(--spacing-6);
    }

    .add-to-basket-drawer__heading {
      font-family: var(--font-family);
      font-size: var(--font-size-body-medium);
      font-weight: 700;
      line-height: var(--line-height-body-medium);
      color: var(--color-content-primary);
      margin: 0;
    }

    .add-to-basket-drawer__close {
      width: 32px;
      height: 32px;
      border: none;
      border-radius: 999px;
      background-color: var(--color-bg-close-button);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .add-to-basket-drawer__close:hover {
      opacity: 0.9;
    }

    .add-to-basket-drawer__close svg {
      width: 12px;
      height: 12px;
    }

    .add-to-basket-drawer__item {
      display: flex;
      align-items: center;
      gap: var(--spacing-6);
      width: 100%;
    }

    .add-to-basket-drawer__item-image {
      width: 56px;
      height: 56px;
      flex-shrink: 0;
      border-radius: var(--border-radius-small);
      overflow: hidden;
      background-color: var(--color-bg-card-media);
    }

    .add-to-basket-drawer__item-image img {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .add-to-basket-drawer__item-details {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: var(--spacing-2);
    }

    .add-to-basket-drawer__item-title {
      font-family: var(--font-family);
      font-size: var(--font-size-body-small);
      font-weight: 700;
      line-height: var(--line-height-body-small);
      color: var(--color-content-primary);
      margin: 0;
    }

    .add-to-basket-drawer__item-price {
      font-family: var(--font-family);
      font-size: var(--font-size-body-small);
      font-weight: 500;
      line-height: var(--line-height-body-small);
      color: var(--color-content-primary);
      margin: 0;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const EXTRAS_TAB_LABELS = ['All', 'Best Sellers', 'Gifts', 'Fan Favourites'];

    const EXTRAS_CARDS = [
      { id: 1, title: 'Manchester City Christmas Bear Plush', variant: '', price: '£8.00', image: './assets/Extras/bear.png' },
      { id: 2, title: 'Manchester City Crest IPhone 17 Pro Max Case', variant: '', price: '£28.00', image: './assets/phone.webp' },
      { id: 3, title: 'Manchester City bobble hat', variant: 'One size', price: '£14.00', image: './assets/Extras/hat.png' },
      { id: 4, title: 'Manchester City Haaland Player Water Bottle', variant: '500ml', price: '£12.00', image: './assets/Extras/bottle.png' },
      { id: 5, title: 'Manchester City Essentials Ball 2025/26', variant: '', price: '£18.00', image: './assets/Extras/701237262001_pp_01_mcfc.webp' },
      { id: 6, title: 'Manchester City Topps Team Set 2025/26', variant: '', price: '£45.00', image: './assets/Extras/701242993001_pp_01_mcfc.webp' },
      { id: 7, title: 'Official Manchester City bottle opener.', variant: '', price: '£9.00', image: './assets/Extras/701233559001_pp_01_mcfc.png' },
      { id: 8, title: 'Manchester City scarf', variant: '', price: '£15.00', image: './assets/Extras/701241672001_pp_01_mcfc.webp' },
      { id: 9, title: 'Official Manchester City pin badge', variant: '', price: '£5.00', image: './assets/Extras/701233555001_pp_01_mcfc.webp' },
      { id: 10, title: 'Manchester City Haaland Funko Pop', variant: '', price: '£18.00', image: './assets/Extras/701233148001_pp_02_mcfc.webp' }
    ];

    function shuffle(arr) {
        const a = [...arr];
        for (let i = a.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
      }

    function computeBasketCount() {
      try {
        const booking = sessionStorage.getItem('stadiumToursLastBooking');
        const addOnsRaw = sessionStorage.getItem('stadiumToursAddOns');
        const addOns = addOnsRaw ? JSON.parse(addOnsRaw) : {};
        const bookingData = booking ? JSON.parse(booking) : null;
        const participantCount = Number(bookingData?.participantTotal) || 0;
        const addOnCount = Object.values(addOns).reduce((sum, item) => sum + (Number(item.quantity) || 0), 0);
        return Math.max(0, participantCount + addOnCount);
      } catch (_) {
        return 0;
      }
    }

    function getExtrasQuantitiesFromStorage() {
      try {
        const addOnsRaw = sessionStorage.getItem('stadiumToursAddOns');
        const addOns = addOnsRaw ? JSON.parse(addOnsRaw) : {};
        const qty = {};
        Object.entries(addOns).forEach(([key, item]) => {
          if (key.startsWith('extras-')) {
            const id = parseInt(key.replace('extras-', ''), 10);
            if (!isNaN(id)) qty[id] = Number(item.quantity) || 0;
          }
        });
        return qty;
      } catch (_) {
        return {};
      }
    }

    function App() {
      const [basketCount, setBasketCount] = useState(() => computeBasketCount());
      const [selectedTab, setSelectedTab] = useState(EXTRAS_TAB_LABELS[0]);
      const [visibleCards, setVisibleCards] = useState(EXTRAS_CARDS);
      const [showAddToBasketDrawer, setShowAddToBasketDrawer] = useState(false);
      const [addedCard, setAddedCard] = useState(null);
      const [drawerSlideOpen, setDrawerSlideOpen] = useState(false);
      const [addingCardId, setAddingCardId] = useState(null);
      const [extrasQuantities, setExtrasQuantities] = useState(() => getExtrasQuantitiesFromStorage());
      const [extrasQuantityOpen, setExtrasQuantityOpen] = useState(null);
      const [dropdownFlipsUp, setDropdownFlipsUp] = useState(false);
      const extrasQuantityRef = useRef(null);
      const activeTabRef = useRef(null);
      const tabSelectionsRef = useRef({});
      const addTimeoutRef = useRef(null);
      const addPopupTimeoutRef = useRef(null);

      useEffect(() => {
        if (selectedTab === 'All') {
          setVisibleCards(EXTRAS_CARDS);
          return;
        }
        if (tabSelectionsRef.current[selectedTab]) {
          setVisibleCards(tabSelectionsRef.current[selectedTab]);
          return;
        }
        const shuffled = shuffle(EXTRAS_CARDS);
        const count = Math.min(4 + Math.floor(Math.random() * 5), EXTRAS_CARDS.length);
        const selection = shuffled.slice(0, count);
        tabSelectionsRef.current[selectedTab] = selection;
        setVisibleCards(selection);
      }, [selectedTab]);

      useEffect(() => {
        function updateCount() {
          setBasketCount(computeBasketCount());
          setExtrasQuantities(getExtrasQuantitiesFromStorage());
        }
        updateCount();
        window.addEventListener('storage', updateCount);
        return () => window.removeEventListener('storage', updateCount);
      }, []);

      useEffect(() => {
        const handleClickOutside = (e) => {
          if (extrasQuantityRef.current && !extrasQuantityRef.current.contains(e.target)) {
            setExtrasQuantityOpen(null);
          }
        };
        if (extrasQuantityOpen !== null) {
          document.addEventListener('mousedown', handleClickOutside);
        }
        return () => document.removeEventListener('mousedown', handleClickOutside);
      }, [extrasQuantityOpen]);

      useEffect(() => {
        if (extrasQuantityOpen === null) return;
        const wrap = extrasQuantityRef.current;
        if (!wrap) return;
        const checkFlip = () => {
          const rect = wrap.getBoundingClientRect();
          const dropdownHeight = 4 * 43 + 8;
          const spaceBelow = window.innerHeight - (rect.bottom + 4);
          setDropdownFlipsUp(spaceBelow < dropdownHeight);
        };
        checkFlip();
        window.addEventListener('scroll', checkFlip, { passive: true });
        window.addEventListener('resize', checkFlip);
        return () => {
          window.removeEventListener('scroll', checkFlip);
          window.removeEventListener('resize', checkFlip);
        };
      }, [extrasQuantityOpen]);

      useEffect(() => {
        if (activeTabRef.current) {
          activeTabRef.current.scrollIntoView({ inline: 'center', block: 'nearest', behavior: 'smooth' });
        }
      }, [selectedTab]);

      useEffect(() => {
        return () => {
          if (addTimeoutRef.current) clearTimeout(addTimeoutRef.current);
          if (addPopupTimeoutRef.current) clearTimeout(addPopupTimeoutRef.current);
        };
      }, []);

      useEffect(() => {
        if (showAddToBasketDrawer && addedCard) {
          const raf = requestAnimationFrame(() => {
            requestAnimationFrame(() => setDrawerSlideOpen(true));
          });
          return () => cancelAnimationFrame(raf);
        } else {
          setDrawerSlideOpen(false);
        }
      }, [showAddToBasketDrawer, addedCard]);

      function updateExtrasQuantity(card, newQty) {
        try {
          const addOnsRaw = sessionStorage.getItem('stadiumToursAddOns');
          const addOns = addOnsRaw ? JSON.parse(addOnsRaw) : {};
          const key = 'extras-' + card.id;
          const priceNum = parseFloat(String(card.price).replace(/[^0-9.]/g, '')) || 0;
          if (newQty <= 0) {
            delete addOns[key];
          } else {
            const existing = addOns[key];
            addOns[key] = existing ? { ...existing, quantity: newQty } : { title: card.title, quantity: newQty, price: priceNum, image: card.image };
          }
          sessionStorage.setItem('stadiumToursAddOns', JSON.stringify(addOns));
          setBasketCount(computeBasketCount());
          setExtrasQuantities(getExtrasQuantitiesFromStorage());
        } catch (_) {}
      }

      function handleAddToBasket(card) {
        setAddingCardId(card.id);
        if (addTimeoutRef.current) clearTimeout(addTimeoutRef.current);
        if (addPopupTimeoutRef.current) clearTimeout(addPopupTimeoutRef.current);
        addTimeoutRef.current = setTimeout(() => {
          addTimeoutRef.current = null;
          setAddingCardId(null);
          addPopupTimeoutRef.current = setTimeout(() => {
            addPopupTimeoutRef.current = null;
            try {
              const addOnsRaw = sessionStorage.getItem('stadiumToursAddOns');
              const addOns = addOnsRaw ? JSON.parse(addOnsRaw) : {};
              const key = 'extras-' + card.id;
              const priceNum = parseFloat(String(card.price).replace(/[^0-9.]/g, '')) || 0;
              const existing = addOns[key];
              if (existing) {
                addOns[key] = { ...existing, quantity: (Number(existing.quantity) || 0) + 1 };
              } else {
                addOns[key] = { title: card.title, quantity: 1, price: priceNum, image: card.image };
              }
              sessionStorage.setItem('stadiumToursAddOns', JSON.stringify(addOns));
              setBasketCount(computeBasketCount());
              setExtrasQuantities(getExtrasQuantitiesFromStorage());
            } catch (_) {}
            setAddedCard(card);
            setDrawerSlideOpen(false);
            setShowAddToBasketDrawer(true);
          }, 800);
        }, 1500);
      }

      return (
        <div className="app">
          <header className="header" role="banner">
            <div className="header__burger">
              <button className="header__menu-btn" aria-label="Open menu">
                <div className="header__menu-icon">
                  <img src="./assets/c16f303c4d01145625249e67fdfa0f7bbf9aa0a9.svg" alt="" />
                </div>
              </button>
            </div>

            <a href="stadium-tours.html" className="header__logo" aria-label="Back to Stadium Tours">
              <img src="./assets/logo.svg" alt="Manchester City FC" width="48" height="48" />
            </a>

            <div className="header__actions">
              <a href="basket.html" className="header__basket" aria-label={basketCount > 0 ? `Shopping basket, ${basketCount} item${basketCount !== 1 ? 's' : ''}` : 'Shopping basket'}>
                <div className="header__basket-icon">
                  <img src="./assets/basket.svg" alt="" className="header__basket-img" />
                  {basketCount > 0 && (
                    <span className="header__basket-number" aria-hidden="true">{basketCount > 99 ? '99+' : basketCount}</span>
                  )}
                </div>
              </a>
            </div>
          </header>

          <main className="app__content">
            <section className="hero" aria-label="Extras hero">
              <img src="./assets/Marketing.png" alt="" className="hero__bg" />
              <div className="hero__overlay" aria-hidden="true" />
              <div className="hero__content">
                <div className="hero__title-block">
                  <h1 className="hero__title">Don't miss these favourites.</h1>
                </div>
                <p className="hero__description">
                  Your hand-picked favourites are still here. Take another look and discover what makes them worth adding to your order
                </p>
              </div>
            </section>

            <div className="extras-tabs">
              <div className="extras-tabs__group" role="tablist" aria-label="Extras categories">
                {EXTRAS_TAB_LABELS.map(label => (
                  <button
                    key={label}
                    ref={selectedTab === label ? activeTabRef : null}
                    role="tab"
                    aria-selected={selectedTab === label}
                    className={`extras-tabs__tab ${selectedTab === label ? 'extras-tabs__tab--active' : ''}`}
                    onClick={() => setSelectedTab(label)}
                  >
                    {label}
                  </button>
                ))}
              </div>
            </div>

            <section className="extras-cards" aria-label="Extras products">
              {visibleCards.map(card => (
                <article key={card.id} className="extras-card">
                  <div className={`extras-card__media${(card.image.includes('Extras/') || card.image.includes('phone.webp')) ? ' extras-card__media--png' : ''}`}>
                    <img src={card.image} alt="" />
                  </div>
                  <div className="extras-card__content">
                    <div className="extras-card__text">
                      <h3 className="extras-card__title">{card.title}</h3>
                      <p className="extras-card__price">{card.price}</p>
                      {card.variant ? <p className="extras-card__variant">{card.variant}</p> : null}
                    </div>
                    {(extrasQuantities[card.id] || 0) > 0 ? (
                      <div className="extras-card__quantity-wrap" ref={extrasQuantityOpen === card.id ? extrasQuantityRef : null}>
                        <button
                          type="button"
                          className="extras-card__quantity-trigger"
                          onClick={() => setExtrasQuantityOpen(extrasQuantityOpen === card.id ? null : card.id)}
                        >
                          {extrasQuantities[card.id]}
                        </button>
                        {extrasQuantityOpen === card.id && (
                          <div className={`extras-card__quantity-dropdown ${dropdownFlipsUp ? 'extras-card__quantity-dropdown--flip-up' : ''}`}>
                            {[0, 1, 2, 3].map(n => (
                              <button
                                key={n}
                                type="button"
                                className="extras-card__quantity-option"
                                onClick={() => {
                                  updateExtrasQuantity(card, n);
                                  setExtrasQuantityOpen(null);
                                }}
                              >
                                {n}
                              </button>
                            ))}
                          </div>
                        )}
                      </div>
                    ) : (
                      <button type="button" className="extras-card__add" disabled={addingCardId !== null} onClick={() => handleAddToBasket(card)} aria-busy={addingCardId === card.id} aria-live="polite">
                        {addingCardId === card.id && (
                          <span className="extras-card__add-spinner" aria-hidden="true">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80" fill="none" role="img" aria-label="Loading">
                              <circle cx="40" cy="40" r="30" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeDasharray="50 138">
                                <animateTransform attributeName="transform" type="rotate" from="0 40 40" to="360 40 40" dur="0.9s" repeatCount="indefinite"/>
                              </circle>
                            </svg>
                          </span>
                        )}
                        Add to basket
                      </button>
                    )}
                  </div>
                </article>
              ))}
            </section>

            <div className="extras-footer">
              <a href="checkout.html" className="basket-cta">Continue to checkout</a>
            </div>

            {showAddToBasketDrawer && addedCard && (
              <>
                <div className="add-to-basket-drawer-backdrop" aria-hidden="true" onClick={() => setShowAddToBasketDrawer(false)} />
                <div className={`add-to-basket-drawer ${drawerSlideOpen ? 'add-to-basket-drawer--open' : ''}`} role="dialog" aria-modal="true" aria-label="Added to basket">
                  <div className="add-to-basket-drawer__panel">
                    <div className="add-to-basket-drawer__header">
                      <h2 className="add-to-basket-drawer__heading">Added to basket</h2>
                      <button type="button" className="add-to-basket-drawer__close" aria-label="Close" onClick={() => setShowAddToBasketDrawer(false)}>
                        <svg viewBox="0 0 12 12" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                          <path d="M1 1l10 10M11 1L1 11" />
                        </svg>
                      </button>
                    </div>
                    <div className="add-to-basket-drawer__item">
                      <div className="add-to-basket-drawer__item-image">
                        <img src={addedCard.image} alt="" />
                      </div>
                      <div className="add-to-basket-drawer__item-details">
                        <p className="add-to-basket-drawer__item-title">{addedCard.title}</p>
                        <p className="add-to-basket-drawer__item-price">{addedCard.price}</p>
                      </div>
                    </div>
                  </div>
                </div>
              </>
            )}
          </main>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
